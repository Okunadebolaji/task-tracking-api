FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# 1. Copy the csproj from the subfolder to the container
COPY ["TaskTrackingApi/TaskTrackingApi.csproj", "TaskTrackingApi/"]

# 2. Restore dependencies
RUN dotnet restore "TaskTrackingApi/TaskTrackingApi.csproj"

# 3. Copy everything else from your computer to the container
COPY . .

# 4. Move into the folder where the project lives to run the build
WORKDIR "/src/TaskTrackingApi"
RUN dotnet publish "TaskTrackingApi.csproj" -c Release -o /app/publish

# Stage 2: Runtime
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app
COPY --from=build /app/publish .

ENTRYPOINT ["dotnet", "TaskTrackingApi.dll"]